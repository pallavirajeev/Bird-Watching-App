[[extend 'layout.html']]

<style>
  [v-cloak] {
    display: none;
  }
</style>

<div class="section" id="app" v-cloak>
  <h1 class="title"><i class="fa-solid fa-list"></i> My Checklists</h1>

  <!-- Checklist Table -->
  <table class="table is-fullwidth">
    <thead>
      <tr>
        <th>Species Name</th>
        <th>Latitude</th>
        <th>Longitude</th>
        <th>Date Observed</th>
        <th>Time Observation Started</th>
        <th>Duration Observed (mins)</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="checklist in checklists" :key="checklist.id">
        <td>{{ checklist.species_name }}</td>
        <td>{{ checklist.latitude }}</td>
        <td>{{ checklist.longitude }}</td>
        <td>{{ checklist.date_observed }}</td>
        <td>{{ checklist.time_observation_started }}</td>
        <td>{{ checklist.duration_observed }}</td>
        <td>
          <a :href="`/edit_checklist/${checklist.id}`" class="button is-small is-info">Edit</a>
          <button @click="deleteChecklist(checklist.id)" class="button is-small is-danger">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

[[block page_scripts]]
<script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  const app = Vue.createApp({
    data() {
      return {
        checklists: [],
      };
    },
    mounted() {
      this.fetchChecklists();
    },
    methods: {
      async fetchChecklists() {
        try {
          const response = await axios.get('/get_checklists');
          this.checklists = response.data.checklists;
        } catch (error) {
          console.error('Error fetching checklists:', error);
        }
      },
      async deleteChecklist(id) {
        try {
          await axios.delete(`/delete_checklist/${id}`);
          alert('Checklist deleted successfully!');
          this.fetchChecklists();  // Re-fetch the list after deletion
        } catch (error) {
          console.error('Error deleting checklist:', error);
        }
      },
    },
  });
  
  app.mount('#app');
</script>
[[end]]
